<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="neck.css" />
    <title>necklace</title>
  </head>
  <body>
    <section class="navbar">
      <div class="logo">
        <img
          src="https://petviet.vn/wp-content/uploads/2019/04/vong-co-gai-cho-cho-1.jpg"
          alt=""
          class="img"
        />
      </div>
      <div class="navbar-info">
        <nav class="navbar-item">
          <a class="navbar-item-link" href="">Home</a>
          <a class="navbar-item-link" href="">Dữ Liệu</a>
          <a class="navbar-item-link" href="">About</a>
        </nav>
        <input type="text" id="Search" placeholder="Search" />
        <button class="btn">Search</button>
      </div>
    </section>
    <section class="main">
      <div class="main-left">
        <div class="flex-box">
          <div class="total box">
            Total Device <br />
            <div id="totalNum" class="number">0</div>
          </div>
          <div class="working box">
            Working Device <br />
            <div id="workingNum" class="number">0</div>
          </div>
          <div class="alert box">
            Alert Device <br />
            <div id="alertNum" class="number">0</div>
          </div>
        </div>
        <div id="googleMap" style="width: 940px; height: 704px"></div>
      </div>
      <div class="main-right">
        <div class="main-right-filter">
          <input type="text" placeholder="Filter" class="filter" />
          <button class="search" id="search_btn">Search</button>
        </div>
        <button class="btn-door" id="servo_btn">OPEN THE DOOR</button>
        <button class="btn-lightbulb" id="led"><i class="fa-regular fa-lightbulb"></i></button>
        <div class="main-content">
            <div class="box mq2" >
                Chỉ số gas <br />
                <div class="number" id="MQ2">0</div>
              </div>
              <div class="box HCSR501" >
                  Cảm biến chuyển động <br />
                  <div class="text" id="HCSR501">Không chuyển động</div>
                </div>
                <div class="box heat" >
                  Cảm biến thân nhiệt <br />
                  <div class="number" id="MAX30100">0</div>
                </div>
                <div class="box C0" >
                  Chỉ số cảm biến C0 <br />
                  <div class="number" id="CO">0</div>
                </div>
                <div class="box SPO2">
                  Chỉ số SPO2 <br />
                  <div class="number" id="SPO2">0</div>
        </div>
          </div>
      </div>
    </section>
<!--    <script src="socket.io.js"></script>-->
    <script src="/socket.io/socket.io.js"></script>
<!--    socket -->
    <script>
      const totalNum = document.getElementById("totalNum");
      // const workingNum = document.getElementById("workingNum");
      // const alertNum = document.getElementById("alertNum");
      const servo_btn = document.getElementById("servo_btn");
      const MQ2 = document.getElementById('MQ2');
      const MAX30100 = document.getElementById('MAX30100');
      const CO = document.getElementById('CO');
      const SPO2 = document.getElementById('SPO2');
      const HCSR501 = document.getElementById('HCSR501');
      const led = document.getElementById('led')
      const search_btn = document.getElementById('search_btn');

      const socket = io();


      //cap nhat toan bo thong tin
      socket.on("BTN", (data) => {
        socket.emit('UPDATE', 'just update')
      })
      search_btn.addEventListener('click', ()=>{
        socket.emit('UPDATE', 'just update')
      })
      //cap nhat so luong thiet bi ket noi
      socket.on("totalDevice", (data) => {
        totalNum.innerText = `${data}`;
      });
      //chi so gas
      socket.on("MQ2", (data)=> {
        MQ2.innerText = data.MQ2;
      })
      //cam bien chuyen dong
      socket.on("HCSR501", (data)=> {
        if (data.message === 'MOTION_DETECTED') {
          HCSR501.innerText = 'Phat hien chuyen dong';
        } else HCSR501.innerText = 'khong co chuyen dong'
      })
      //cam bien than nhiet
      socket.on('MAX30100', (data) => {
        MAX30100.innerText = data;
      })
      //cam bien CO
      socket.on('CO', (data) => {
        CO.innerText = data;
      })
      //chi so SPO2
      socket.on('SPO2',(data) => {
        SPO2.innerText = data;
      })
      //led
      socket.on('LED_STATUS', (data) => {
        if (data.message === 'ON') {led.style.backgroundColor = "red"}
        else if (data.message === 'OFF') led.style.backgroundColor = "white"
      })
      led.addEventListener("click", ()=> {
        if (led.style.backgroundColor === "red") {
          led.style.backgroundColor = "white";
          socket.emit("LED", "OFF");
        } else {
          led.style.backgroundColor = "red";
          socket.emit("LED", "ON");
        }
      })

      //dong/mo cong
      socket.on('msg', (data) =>{
        if (data === 'MO_CONG') {
          servo_btn.textContent = "CLOSE THE DOOR";
        } else servo_btn.textContent = "OPEN THE DOOR";
      })
      servo_btn.addEventListener("click", () => {
        if (servo_btn.textContent === "OPEN THE DOOR") {
          servo_btn.textContent = "CLOSE THE DOOR";
          // servo_btn.style.color = "red";
          socket.emit("msg", "MO_CONG");
        } else {
          servo_btn.textContent = "OPEN THE DOOR";
          // servo_btn.style.color = "green";
          socket.emit("msg", "DONG_CONG");
        }
      });
    </script>
<!-- google map   -->
    <script>
      function myMap() {
        const mapProp1 = {
          center: new google.maps.LatLng(20.99861496637506, 105.85524747787383),
          zoom: 15,
        };
        const mapProp2 = {
          center: new google.maps.LatLng(21.99861496637506, 107.85524747787383),
          zoom: 15,
        };
        const map = new google.maps.Map(
          document.getElementById("googleMap"),
          mapProp1,
          mapProp2
        );
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmRAp1Vw0nUZIuwShewL3NHEu_MO52Wc8&callback=myMap"></script>
  </body>
</html>
